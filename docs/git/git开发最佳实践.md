# git开发最佳实践
## 框架
### 开发流程
对于框架，应该使用版本对应的分支开发，如果要升级版本，则将当前最新分支的代码合并回master，从master拉取一个新分支作为新版本的开发分支，同时旧分支原则上不在进行功能性更新，只对BUG、漏洞进行修复；


开发流程示例：
```
对于当前一个框架A，有两个分支，一个v1.0.0，一个v2.0.0，当前开发分支是v2.0.0，如果此时想要升
级框架版本，则先将v2.0.0的代码合并回master，然后从master分支拉取一个v3.0.0分支，最后后续开
发就在v3.0.0分支上进行，原则上v1.0.0、v2.0.0两个分支代码不进行变动；
```


对历史版本修复BUG、漏洞流程：
```
对于当前一个框架A，有两个分支，一个v1.0.0，一个v2.0.0，一个v3.0.0，当前开发分支是v3.0.0，
如果此时发现v1.0.0中有一个BUG/漏洞，想要修复，此时先将分支切回v1.0.0，然后从v1.0.0分支拉
取一个新分支用来修复BUG/漏洞，修复测试完毕后合并回v1.0.0，同时检查当前v2.0.0、v3.0.0分支
是否也有该BUG/漏洞（大概率也会有），如果有，则将v1.0.0分支上的修复提交通过cherry-pick的
方式同步到v2.0.0、v3.0.0分支上（可能会有冲突，有冲突合并下即可），最后将三个分支版本重新
发布到maven仓库即可（注意：目前maven仓库是允许覆盖发布的，所以是可以这样做的）；
```

### 版本管理
如果不涉及兼容问题，尽量不要升级版本，尽量维持一个版本不变，因为版本变多后维护成本会升高，推动各个业务线升级的成本也比较高；

## 独立部署的应用
### 正常开发流程
- 1、从最后一次发布的tag拉取分支A；
- 2、在分支A上开发；
- 3、在分支A上测试；
- 4、将分支合并到master；
- 5、判断从最后一次发布的tag拉取分支后是否有紧急迭代，如果有，将其合并到分支A，然后合并到master；
- 6、全量回归测试（判断从拉取分支A以来是否有发布，如果有，对分支A的变更进行回归测试确保变更不会对已发布的内容产生影响，同时对已发布的变更进行回归测试，防止分支A的变更影响其他发布变更的功能）
- 7、判断是否有紧急迭代发布过，如果有回到第5步，如果没有，发布，同时为本次发布打tag；

### 紧急发布流程
- 1、从最后一次发布的tag拉取分支A；
- 2、在分支A上开发；
- 3、在分支A上测试；
- 4、判断从第1步到这里是否有发布，如果有，则需要合并代码，回到第3步；如果没有，将分支A发布，同时为本次发布打tag

### 实施细节
- 如果有一个正常流程已经进入到第4步，那么在该流程发布完成前不允许其他任何正常流程进入到第4步；
- 无论是紧急发布流程还是正常流程，都不允许并发发布，同时发布的只能有一个，紧急流程和正常发布流程也不能同时发布；
- 请尽量确保紧急流程先于同时进行的正常流程发布，否则紧急流程会因为第4步检查导致大量的回归测试工作，最终导致紧急发布流程进度缓慢；
- 紧急发布流程只允许同时存在一个，在一个紧急发布流程结束前不允许创建另外一个紧急发布流程（虽然模型上允许，但是会导致紧急发布流程进度变慢，丧失紧急发布流程的意义）；
- 注意两个发布流程的第1步，均是从最后一次发布的tag拉取分支A而不是master，虽然大多数情况下master分支和最后一次发布的tag之间代码是一致没有变更的，但是如果某个正常流程已经合并到master，但是还未发布，此时有一个紧急迭代需要发布，如果此时从master分支直接拉取新分支会有问题，因为里边包含准备发布但是还未发布的代码，最终会导致这部分代码提前发布上线，而从最后一次发布的tag拉取分支就没有这个问题； 

